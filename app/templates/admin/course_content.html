{% extends "base.html" %}

{% block title %}Course Content - Admin{% endblock %}

{% block content %}
<div class="container" style="max-width: 1200px; margin: 0 auto; padding: 2rem 1rem;">
    <!-- Back Navigation -->
    <div style="margin-bottom: 2rem;">
        {% if not student_view %}
        <a href="{{ url_for('admin_bp.courses') }}" class="text-muted text-sm"
            style="text-decoration: none; display: flex; align-items: center; gap: 0.5rem; width: fit-content; transition: color 0.2s;">
            <span class="iconify" data-icon="heroicons:arrow-left"></span> Back to Courses
        </a>
        {% else %}
        <a href="{{ url_for('main.student_dashboard') }}" class="text-muted text-sm"
            style="text-decoration: none; display: flex; align-items: center; gap: 0.5rem; width: fit-content; transition: color 0.2s;">
            <span class="iconify" data-icon="heroicons:arrow-left"></span> Back to Dashboard
        </a>
        {% endif %}
    </div>

    <!-- Centered Header -->
    <div class="page-header" style="text-align: center; margin-bottom: 3rem;">
        <h1 style="font-size: 2.5rem; font-weight: 800; margin-bottom: 0.5rem;">
            <span class="gradient-text">{{ course.title }}</span>
        </h1>
        <p style="color: var(--text-secondary); font-size: 1.1rem;">Manage modules, lessons, and assignments.</p>
    </div>

    <!-- Tabs -->
    <div class="tabs"
        style="border-bottom: 1px solid var(--border-light); margin-bottom: 2rem; display: flex; gap: 2rem;">
        <button onclick="switchTab('curriculum')" id="tab-curriculum" class="tab-btn active"
            style="background: none; border: none; padding: 0.5rem 0; color: var(--text-muted); cursor: pointer; border-bottom: 2px solid transparent; font-size: 1rem; transition: all 0.2s;">
            Curriculum
        </button>
        <button onclick="switchTab('quizzes')" id="tab-quizzes" class="tab-btn"
            style="background: none; border: none; padding: 0.5rem 0; color: var(--text-muted); cursor: pointer; border-bottom: 2px solid transparent; font-size: 1rem; transition: all 0.2s;">
            Quizzes
        </button>
        <button onclick="switchTab('assignments')" id="tab-assignments" class="tab-btn"
            style="background: none; border: none; padding: 0.5rem 0; color: var(--text-muted); cursor: pointer; border-bottom: 2px solid transparent; font-size: 1rem; transition: all 0.2s;">
            Assignments
            {% set ns = namespace(pending_total=0) %}
            {% for mod in course.modules %}
            {% for lsn in mod.lessons %}
            {% if lsn.assignment %}
            {% set p_count = lsn.assignment.submissions | selectattr('grade', 'none') | list | length %}
            {% set ns.pending_total = ns.pending_total + p_count %}
            {% endif %}
            {% endfor %}
            {% endfor %}
            {% if ns.pending_total > 0 %}
            <span class="badge badge-danger" style="margin-left: 0.5rem; padding: 2px 6px; font-size: 0.7rem;">{{
                ns.pending_total }}</span>
            {% endif %}
        </button>
    </div>

    <!-- Curriculum Tab -->
    <div id="content-curriculum" class="tab-content" style="display: block;">
        {% if not student_view %}
        <div class="glass-card"
            style="margin-bottom: 2rem; border-style: dashed; padding: 1.5rem; background: rgba(59, 130, 246, 0.05); border-color: rgba(59, 130, 246, 0.2);">
            <form action="{{ url_for('admin_bp.add_module', course_id=course.id) }}" method="POST"
                style="display: flex; gap: 1rem; align-items: center;">
                <input type="text" name="title" placeholder="New Module Name (e.g. Week 1)" required
                    class="form-control" style="flex: 1;">
                <button type="submit" class="btn btn-primary" style="white-space: nowrap;">
                    <span class="iconify" data-icon="heroicons:plus"></span> Add Module
                </button>
            </form>
        </div>
        {% endif %}

        {% for module in course.modules %}
        <div style="margin-bottom: 2.5rem;">
            <div
                style="display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 1rem; padding-left: 1rem; border-left: 3px solid var(--primary);">
                <h3 style="margin: 0; font-size: 1.25rem;">{{ module.title }}</h3>
                <span class="text-sm text-muted">{{ module.lessons|length }} Lessons</span>
            </div>

            <div class="glass-card" style="padding: 0; overflow: hidden;">
                {% if module.lessons %}
                <div class="list-group">
                    {% for lesson in module.lessons %}
                    <div class="list-item"
                        onclick="window.location='{{ url_for('main.lesson_player', lesson_id=lesson.id) }}'"
                        style="cursor: pointer; padding: 1.25rem 1.5rem; border-bottom: 1px solid rgba(255,255,255,0.05); transition: background 0.2s; display: flex; justify-content: space-between; align-items: center;">
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div class="icon-circle {{ 'success' if lesson.id in completed_lesson_ids else 'muted' }}"
                                style="width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; background: rgba(255,255,255,0.05); color: var(--text-muted);">
                                {% if lesson.id in completed_lesson_ids %}
                                <span class="iconify" data-icon="heroicons:check" style="color: var(--success);"></span>
                                {% else %}
                                <span class="iconify" data-icon="heroicons:play" style="font-size: 0.9rem;"></span>
                                {% endif %}
                            </div>
                            <div>
                                <div style="font-weight: 500; font-size: 1.05rem;">{{ lesson.title }}</div>
                                <div class="text-xs text-muted"
                                    style="display: flex; gap: 0.5rem; margin-top: 0.25rem;">
                                    {% if lesson.quiz %}
                                    <span
                                        style="color: var(--warning); display: flex; align-items: center; gap: 0.25rem;">
                                        <span class="iconify" data-icon="heroicons:question-mark-circle"></span> Quiz
                                    </span>
                                    {% endif %}
                                    {% if lesson.assignment %}
                                    <span
                                        style="color: var(--primary); display: flex; align-items: center; gap: 0.25rem;">
                                        <span class="iconify" data-icon="heroicons:document-text"></span> Assignment
                                    </span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="actions" onclick="event.stopPropagation();">
                            {% if not student_view %}
                            <button class="btn btn-sm btn-primary"
                                onclick="openEditLessonModal('{{ lesson.id }}', '{{ lesson.title | replace("'", "\\'") }}', '{{ lesson.video_url }}')"
                                title="Edit">
                                <span class="iconify" data-icon="heroicons:pencil-square"></span>
                            </button>
                            <button class="btn btn-sm btn-danger"
                                onclick="openDeleteModal('{{ url_for('admin_bp.delete_lesson', lesson_id=lesson.id) }}')"
                                title="Delete">
                                <span class="iconify" data-icon="heroicons:trash"></span>
                            </button>
                            {% else %}
                            {% if lesson.assignment %}
                            <a href="{{ url_for('main.lesson_player', lesson_id=lesson.id) }}"
                                class="btn btn-sm btn-outline">Assignment</a>
                            {% endif %}
                            {% if lesson.quiz %}
                            <a href="{{ url_for('main.take_quiz', lesson_id=lesson.id) }}"
                                class="btn btn-sm btn-outline">Quiz</a>
                            {% endif %}
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center text-muted" style="padding: 3rem;">No lessons yet.</div>
                {% endif %}

                {% if not student_view %}
                <div
                    style="padding: 1.5rem; background: rgba(0,0,0,0.2); border-top: 1px solid rgba(255,255,255,0.05);">
                    <form action="{{ url_for('admin_bp.add_lesson', module_id=module.id) }}" method="POST"
                        style="display: flex; gap: 0.5rem;">
                        <input type="text" name="title" placeholder="New Lesson Title" required class="form-control"
                            style="flex: 2;">
                        <input type="text" name="video_url" placeholder="Video URL (Optional)" class="form-control"
                            style="flex: 1;">
                        <button type="submit" class="btn btn-sm btn-secondary">Add Lesson</button>
                    </form>
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Quizzes Tab -->
    <div id="content-quizzes" class="tab-content" style="display: none;">
        {% if not student_view %}
        <div class="glass-card text-center" style="margin-bottom: 2rem; border-style: dashed; padding: 3rem;">
            <div style="margin-bottom: 1rem; color: var(--text-muted);">Create standalone quizzes for your lessons</div>
            <button onclick="openQuickAddModal('quiz')" class="btn btn-primary hover-scale">
                <span class="iconify" data-icon="heroicons:plus-circle"></span> Create New Quiz
            </button>
        </div>
        {% endif %}

        <div class="glass-card" style="padding: 0; overflow: hidden;">
            {% for module in course.modules %}
            {% for lesson in module.lessons %}
            {% if lesson.quiz %}
            <div class="list-item"
                style="border-bottom: 1px solid rgba(255,255,255,0.05); padding: 1.5rem; display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h4 style="margin: 0; font-size: 1.1rem;">{{ lesson.quiz.title }}</h4>
                    <span class="text-sm text-muted">Lesson: {{ lesson.title }} â€¢ {{ lesson.quiz.questions|length }}
                        Questions</span>
                </div>
                <div style="display: flex; gap: 0.5rem;">
                    <div style="display: flex; gap: 0.5rem;">
                        {% if not student_view %}
                        <button class="btn btn-sm btn-secondary"
                            data-questions='{{ lesson.quiz.questions_list | tojson }}'
                            onclick="viewQuiz('{{ lesson.quiz.title | replace("'", "\\'") }}', this)">
                            <span class="iconify" data-icon="heroicons:eye"></span> Preview
                        </button>
                        <a href="{{ url_for('admin_bp.add_quiz', lesson_id=lesson.id) }}"
                            class="btn btn-sm btn-primary">
                            <span class="iconify" data-icon="heroicons:pencil-square"></span> Edit
                        </a>
                        <button class="btn btn-sm btn-danger"
                            onclick="openDeleteModal('{{ url_for('admin_bp.delete_quiz', lesson_id=lesson.id) }}')">
                            <span class="iconify" data-icon="heroicons:trash"></span> Remove
                        </button>
                        {% else %}
                        <a href="{{ url_for('main.take_quiz', lesson_id=lesson.id) }}"
                            class="btn btn-sm btn-primary">Take
                            Quiz</a>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endif %}
            {% endfor %}
            {% endfor %}
        </div>
    </div>

    <!-- Assignments Tab -->
    <div id="content-assignments" class="tab-content" style="display: none;">
        {% if not student_view %}
        <div class="glass-card text-center" style="margin-bottom: 2rem; border-style: dashed; padding: 3rem;">
            <div style="margin-bottom: 1rem; color: var(--text-muted);">Create assignments for students to upload</div>
            <button onclick="openQuickAddModal('assignment')" class="btn btn-primary hover-scale">
                <span class="iconify" data-icon="heroicons:plus-circle"></span> Create New Assignment
            </button>
        </div>
        {% endif %}

        <div class="glass-card" style="padding: 0; overflow: hidden;">
            {% for module in course.modules %}
            {% for lesson in module.lessons %}
            {% if lesson.assignment %}
            <div class="list-item"
                style="border-bottom: 1px solid rgba(255,255,255,0.05); padding: 1.5rem; display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h4 style="margin: 0; font-size: 1.1rem;">{{ lesson.title }}</h4>
                    <div class="text-sm text-muted">Max Score: {{ lesson.assignment.max_score }}</div>
                    {% if lesson.assignment.resource_path %}
                    <a href="{{ url_for('main.download_assignment_resource', assignment_id=lesson.assignment.id) }}"
                        class="text-xs text-primary" style="display: inline-flex; align-items: center; gap: 0.3rem;">
                        <span class="iconify" data-icon="heroicons:paper-clip"></span> Resource Attached
                    </a>
                    {% endif %}
                </div>
                <div style="display: flex; gap: 0.5rem;">
                    {% if not student_view %}
                    <button class="btn btn-sm btn-secondary view-assign-btn"
                        data-instructions="{{ lesson.assignment.instructions }}"
                        data-score="{{ lesson.assignment.max_score }}"
                        data-resource="{{ lesson.assignment.resource_path }}">
                        <span class="iconify" data-icon="heroicons:document-text"></span> Details
                    </button>

                    <button class="btn btn-sm btn-primary edit-assign-btn" data-id="{{ lesson.assignment.id }}"
                        data-instructions="{{ lesson.assignment.instructions }}"
                        data-score="{{ lesson.assignment.max_score }}">
                        <span class="iconify" data-icon="heroicons:pencil-square"></span> Edit
                    </button>

                    <a href="{{ url_for('admin_bp.assignment_submissions', assignment_id=lesson.assignment.id) }}"
                        class="btn btn-sm btn-secondary">
                        <span class="iconify" data-icon="heroicons:inbox-arrow-down"></span> Submissions
                        {% set p_len = lesson.assignment.submissions | selectattr('grade', 'none') | list | length %}
                        {% if p_len > 0 %}<span class="badge badge-danger" style="margin-left:5px;">{{ p_len }}</span>{%
                        endif %}
                    </a>

                    <button class="btn btn-sm btn-danger"
                        onclick="openDeleteModal('{{ url_for('admin_bp.delete_assignment', assignment_id=lesson.assignment.id) }}')">
                        <span class="iconify" data-icon="heroicons:trash"></span> Remove
                    </button>
                    {% else %}
                    <a href="{{ url_for('main.lesson_player', lesson_id=lesson.id) }}" class="btn btn-sm btn-primary">Go
                        to
                        Assignment</a>
                    {% endif %}
                </div>
            </div>
            {% elif not student_view %}
            <div class="list-item"
                style="opacity: 0.5; border-bottom: 1px solid rgba(255,255,255,0.05); padding: 1rem 1.5rem; display: flex; justify-content: space-between;">
                <span class="text-muted">{{ lesson.title }}</span>
                <button onclick="openAddAssignmentModal('{{ lesson.id }}')" class="btn btn-xs btn-outline">+ Add
                    Assignment</button>
            </div>
            {% endif %}
            {% endfor %}
            {% endfor %}
        </div>
    </div>

    <!-- Modals -->
    <div id="editLessonModal" class="modal"
        style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(4px); z-index: 100; align-items: center; justify-content: center;">
        <div class="glass-card" style="width: 100%; max-width: 450px; padding: 2rem;">
            <h3 style="margin-top: 0;">Edit Lesson</h3>
            <form id="editLessonForm" method="POST">
                <div class="form-group"><label>Title</label><input type="text" id="editLessonTitle" name="title"
                        class="form-control"></div>
                <div class="form-group"><label>Video URL</label><input type="text" id="editLessonVideoUrl"
                        name="video_url" class="form-control"></div>
                <div style="display:flex; justify-content:flex-end; gap:1rem; margin-top:1.5rem;">
                    <button type="button" class="btn btn-ghost" onclick="closeModals()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Update</button>
                </div>
            </form>
        </div>
    </div>

    <div id="deleteModal" class="modal"
        style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(4px); z-index: 100; align-items: center; justify-content: center;">
        <div class="glass-card" style="width: 100%; max-width: 400px; padding: 2rem; border-color: var(--danger);">
            <h3 class="text-danger" style="margin-top: 0;">Confirm Deletion</h3>
            <p class="text-muted">Are you sure? This cannot be undone.</p>
            <div style="display:flex; justify-content:flex-end; gap:1rem; margin-top:1.5rem;">
                <button type="button" class="btn btn-ghost" onclick="closeModals()">Cancel</button>
                <form id="deleteForm" method="POST" style="margin:0;"><button type="submit"
                        class="btn btn-danger">Delete</button></form>
            </div>
        </div>
    </div>

    <div id="quickAddModal" class="modal"
        style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(4px); z-index: 100; align-items: center; justify-content: center;">
        <div class="glass-card" style="width: 450px; padding: 2rem;">
            <h3 id="quickAddTitle" style="margin-top: 0;">Add Content</h3>
            <form action="{{ url_for('admin_bp.quick_add_content', course_id=course.id) }}" method="POST">
                <input type="hidden" id="quickAddType" name="type" value="quiz">
                <div class="form-group">
                    <label>Module</label>
                    <!-- Custom Dropdown Replacement -->
                    <div class="custom-select-wrapper" id="moduleSelectWrapper">
                        <input type="hidden" name="module_id" id="moduleSelectInput" required>
                        <!-- Hidden input for form submission -->
                        <div class="custom-select-trigger form-control"
                            onclick="this.closest('.custom-select-wrapper').classList.toggle('open')">
                            <span class="custom-selected-text" style="color: var(--text-secondary);">Select
                                Module</span>
                            <span class="iconify" data-icon="heroicons:chevron-down"
                                style="color: var(--text-muted);"></span>
                        </div>
                        <div class="custom-options">
                            {% for module in course.modules %}
                            <div class="custom-option"
                                onclick="selectCustomOption(this, '{{ module.id }}', '{{ module.title }}')">
                                {{ module.title }}
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Title</label>
                    <input type="text" name="title" required class="form-control">
                </div>
                <div style="display:flex; justify-content:flex-end; gap:1rem; margin-top:1.5rem;">
                    <button type="button" class="btn btn-ghost" onclick="closeModals()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create</button>
                </div>
            </form>
        </div>
    </div>

    <div id="assignmentModal" class="modal"
        style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(4px); z-index: 100; align-items: center; justify-content: center;">
        <div class="glass-card" style="width: 500px; padding: 2rem;">
            <h3 id="assignModalTitle" style="margin-top: 0;">Add Assignment</h3>
            <form id="assignmentForm" method="POST" enctype="multipart/form-data">
                <div class="form-group"><label>Max Score</label><input type="number" id="assignScore" name="max_score"
                        value="100" class="form-control"></div>
                <div class="form-group"><label>Instructions</label><textarea id="assignInstr" name="instructions"
                        rows="4" class="form-control"></textarea></div>
                <div class="form-group"><label>Resource</label><input type="file" name="resource_file"
                        class="form-control" style="border: none; padding: 0;"></div>
                <div style="display:flex; justify-content:flex-end; gap:1rem; margin-top:1.5rem;">
                    <button type="button" class="btn btn-ghost" onclick="closeModals()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <div id="viewQuizModal" class="modal"
        style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(4px); z-index: 100; align-items: center; justify-content: center;">
        <div class="glass-card" style="width: 600px; max-height: 80vh; overflow-y: auto; padding: 2rem;">
            <div style="border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 1rem; margin-bottom: 1rem;">
                <h3 id="viewQuizTitle" style="margin:0;">Quiz Preview</h3>
            </div>
            <div id="viewQuizContent"></div>
            <div style="text-align: right; margin-top: 1.5rem;">
                <button class="btn btn-ghost" onclick="closeModals()">Close</button>
            </div>
        </div>
    </div>

    <script>
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.style.display = 'none');
            document.querySelectorAll('.tab-btn').forEach(el => {
                el.classList.remove('active');
                el.style.color = 'var(--text-muted)';
                el.style.borderBottomColor = 'transparent';
            });

            document.getElementById('content-' + tabId).style.display = 'block';
            const activeBtn = document.getElementById('tab-' + tabId);
            activeBtn.classList.add('active');
            activeBtn.style.color = 'var(--primary)';
            activeBtn.style.borderBottomColor = 'var(--primary)';
            activeBtn.style.fontWeight = '500';
        }

        switchTab('curriculum');

        function closeModals() {
            document.querySelectorAll('.modal').forEach(el => el.style.display = 'none');
        }

        function openEditLessonModal(id, title, url) {
            document.getElementById('editLessonForm').action = "/admin/lesson/" + id + "/edit";
            document.getElementById('editLessonTitle').value = title;
            document.getElementById('editLessonVideoUrl').value = url != 'None' ? url : '';
            document.getElementById('editLessonModal').style.display = 'flex';
        }

        function openDeleteModal(url) {
            document.getElementById('deleteForm').action = url;
            document.getElementById('deleteModal').style.display = 'flex';
        }

        function openQuickAddModal(type) {
            document.getElementById('quickAddType').value = type;
            document.getElementById('quickAddTitle').innerText = type === 'quiz' ? 'Create Quiz' : 'Create Assignment';
            document.getElementById('quickAddModal').style.display = 'flex';
        }

        function openAddAssignmentModal(lessonId) {
            document.getElementById('assignmentForm').action = `/admin/lesson/${lessonId}/add_assignment`;
            document.getElementById('assignModalTitle').innerText = 'Add Assignment';
            document.getElementById('assignmentModal').style.display = 'flex';
        }

        function viewQuiz(title, btn) {
            document.getElementById('viewQuizTitle').innerText = title;
            const container = document.getElementById('viewQuizContent');
            container.innerHTML = '';
            try {
                // Get JSON from data attribute (safe from HTML escaping issues)
                const qJson = btn.getAttribute('data-questions');
                const qs = JSON.parse(qJson);

                if (!qs || qs.length === 0) {
                    container.innerHTML = '<div class="text-muted text-center">No questions in this quiz.</div>';
                } else {
                    qs.forEach((q, idx) => {
                        let opts = typeof q.options === 'string' ? JSON.parse(q.options) : q.options;
                        let optHtml = opts.map((opt, i) =>
                            `<li style="${i === Number(q.correct_option) ? 'color: var(--success); font-weight:500;' : 'color: var(--text-secondary);'} padding: 0.2rem 0;">${opt}</li>`
                        ).join('');
                        container.innerHTML += `
                        <div style="margin-bottom:1.5rem; background: rgba(0,0,0,0.2); padding: 1rem; border-radius: 8px;">
                            <h5 style="margin: 0 0 0.5rem 0; color: var(--text-primary);">Q${idx + 1}: ${q.text}</h5>
                            <ul style="list-style: none; padding: 0; margin: 0;">${optHtml}</ul>
                        </div>`;
                    });
                }
            } catch (e) {
                console.error('Quiz Preview Error:', e);
                container.innerText = 'Error loading questions. Data format invalid.';
            }
            document.getElementById('viewQuizModal').style.display = 'flex';
        }

        window.onclick = function (e) {
            if (e.target.classList.contains('modal')) closeModals();
        }

        // --- Assignment Button Logic ---
        document.querySelectorAll('.view-assign-btn').forEach(btn => {
            btn.addEventListener('click', function () {
                const instr = this.getAttribute('data-instructions');
                const score = this.getAttribute('data-score');
                const res = this.getAttribute('data-resource');

                // Re-use viewQuizModal structure but change content
                document.getElementById('viewQuizTitle').innerText = 'Assignment Details';
                const container = document.getElementById('viewQuizContent');

                let html = `
                <div style="margin-bottom: 1rem;">
                    <h5 style="color: var(--text-secondary); font-size: 0.9rem;">Max Score</h5>
                    <div style="font-size: 1.1rem; font-weight: 500;">${score}</div>
                </div>
                <div style="margin-bottom: 1rem;">
                    <h5 style="color: var(--text-secondary); font-size: 0.9rem;">Instructions</h5>
                    <div style="white-space: pre-wrap; color: var(--text-primary); background: rgba(0,0,0,0.2); padding: 1rem; border-radius: 6px;">${instr}</div>
                </div>`;

                if (res && res !== 'None') {
                    html += `
                <div style="margin-top: 1rem;">
                    <a href="/download_resource/${res.split('/').pop()}" class="btn btn-sm btn-outline">
                        <span class="iconify" data-icon="heroicons:paper-clip"></span> Download Resource
                    </a>
                </div>`;
                }

                container.innerHTML = html;
                document.getElementById('viewQuizModal').style.display = 'flex';
            });
        });

        document.querySelectorAll('.edit-assign-btn').forEach(btn => {
            btn.addEventListener('click', function () {
                const id = this.getAttribute('data-id');
                const instr = this.getAttribute('data-instructions');
                const score = this.getAttribute('data-score');

                document.getElementById('assignmentForm').action = `/admin/assignment/${id}/edit`;
                document.getElementById('assignModalTitle').innerText = 'Edit Assignment';
                document.getElementById('assignScore').value = score;
                document.getElementById('assignInstr').value = instr;

                document.getElementById('assignmentModal').style.display = 'flex';
            });
        });
    </script>
</div>

<style>
    .gradient-text {
        background: linear-gradient(to right, #60a5fa, #a78bfa);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        font-weight: 800;
        margin-bottom: 0.25rem;
    }
</style>
{% endblock %}