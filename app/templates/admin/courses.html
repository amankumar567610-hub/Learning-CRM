{% extends "base.html" %}


{% block content %}
<div style="display: flex; min-height: 100vh;">
    <!-- Sidebar -->
    <div class="sidebar"
        style="width: var(--sidebar-width); background: var(--bg-sidebar); border-right: 1px solid var(--border); padding: 2rem 1rem; position: fixed; height: 100vh; overflow-y: auto;">
        <h3 style="margin-bottom: 2rem; padding-left: 1rem; font-size: 1.25rem;">Course Admin</h3>
        <nav>
            <ul style="list-style: none; padding: 0; margin: 0;">
                <li><a href="{{ url_for('main.dashboard') }}" class="sidebar-link">Dashboard</a></li>
                <li><a href="{{ url_for('admin_bp.categories') }}" class="sidebar-link">Categories</a></li>
                <li><a href="{{ url_for('admin_bp.courses') }}" class="sidebar-link active">Courses</a></li>
                <li><a href="{{ url_for('admin_bp.students') }}" class="sidebar-link">Students</a></li>
                <li style="margin-top: 2rem;">
                    <a href="{{ url_for('auth.logout') }}" class="sidebar-link" style="color: var(--danger);">Logout</a>
                </li>
            </ul>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="content-wrapper">

        <header style="margin-bottom: 3rem;">
            <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">Manage Courses</h1>
            <p style="color: var(--text-secondary);">Create and manage your video courses.</p>
        </header>

        <!-- Create Course Form -->
        <div class="glass-card" style="margin-bottom: 3rem; max-width: 600px; margin-left: auto; margin-right: auto;">
            <h3
                style="margin-bottom: 1rem; font-size: 1.1rem; border-bottom: 1px solid var(--border); padding-bottom: 0.8rem;">
                Create New Course</h3>
            <form method="POST" action="" enctype="multipart/form-data">
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label for="title"
                        style="display: block; margin-bottom: 0.4rem; color: var(--text-secondary); font-size: 0.9rem;">Course
                        Title</label>
                    <input type="text" name="title" id="title" required
                        style="width: 100%; padding: 0.6rem; background: var(--bg-color); border: 1px solid var(--border); color: white; border-radius: 6px;">
                </div>

                <div class="form-group" style="margin-bottom: 1rem;">
                    <label for="category_id"
                        style="display: block; margin-bottom: 0.4rem; color: var(--text-secondary); font-size: 0.9rem;">Category</label>
                    <select name="category_id" id="category_id" required
                        style="width: 100%; padding: 0.6rem; background: var(--bg-color); border: 1px solid var(--border); color: var(--text-primary); border-radius: 6px; appearance: none;">
                        <option value="" disabled selected>Select a Category</option>
                        {% for category in categories %}
                        <option value="{{ category.id }}">{{ category.name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group" style="margin-bottom: 1rem;">
                    <label for="thumbnail_file"
                        style="display: block; margin-bottom: 0.4rem; color: var(--text-secondary); font-size: 0.9rem;">Thumbnail
                        Image (Upload)</label>
                    <input type="file" name="thumbnail_file" id="thumbnail_file" accept="image/*"
                        style="width: 100%; padding: 0.6rem; background: var(--bg-color); border: 1px solid var(--border); color: white; border-radius: 6px;">
                </div>

                <div class="form-group" style="margin-bottom: 1rem;">
                    <label for="thumbnail_url"
                        style="display: block; margin-bottom: 0.4rem; color: var(--text-secondary); font-size: 0.9rem;">OR
                        Thumbnail URL</label>
                    <input type="text" name="thumbnail_url" id="thumbnail_url" placeholder="https://..."
                        style="width: 100%; padding: 0.6rem; background: var(--bg-color); border: 1px solid var(--border); color: white; border-radius: 6px;">
                </div>

                <div class="form-group" style="margin-bottom: 1.5rem;">
                    <label for="description"
                        style="display: block; margin-bottom: 0.4rem; color: var(--text-secondary); font-size: 0.9rem;">Description</label>
                    <textarea name="description" id="description" rows="3" required
                        style="width: 100%; padding: 0.6rem; background: var(--bg-color); border: 1px solid var(--border); color: var(--text-primary); border-radius: 6px; font-family: inherit; resize: vertical;"></textarea>
                </div>

                <button type="submit" class="btn btn-primary" style="padding: 0.8rem 2rem;">Create Course</button>
            </form>
        </div>

        <!-- Course List -->
        <h3 style="margin-bottom: 1.5rem; font-size: 1.25rem;">Your Courses</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 2rem;">
            {% for course in courses %}
            <div class="glass-card"
                style="padding: 0; overflow: hidden; display: flex; flex-direction: column; position: relative;">
                <button
                    onclick="openDeleteCourseModal('{{ url_for('admin_bp.delete_course', course_id=course.id) }}', '{{ course.title | replace("
                    \'", "\\\'" ) | replace('"', '&quot;' ) }}')" class="delete-course-btn" title="Delete Course">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="3 6 5 6 21 6"></polyline>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                    </svg>
                </button>
                {% if course.thumbnail_url %}
                {% if course.thumbnail_url.startswith('http') %}
                <img src="{{ course.thumbnail_url }}" alt="{{ course.title }}"
                    style="width: 100%; height: 180px; object-fit: cover;">
                {% else %}
                <img src="{{ url_for('static', filename='uploads/' + course.thumbnail_url) }}" alt="{{ course.title }}"
                    style="width: 100%; height: 180px; object-fit: cover;">
                {% endif %}
                {% else %}
                <div
                    style="width: 100%; height: 180px; background: rgba(255,255,255,0.05); display: flex; align-items: center; justify-content: center; color: var(--text-secondary); font-size: 1.5rem;">
                    {{ course.title[:2] }}
                </div>
                {% endif %}
                <div style="padding: 1.5rem; flex: 1; display: flex; flex-direction: column;">
                    <span
                        style="font-size: 0.75rem; color: var(--accent); text-transform: uppercase; font-weight: 600; letter-spacing: 0.05em; margin-bottom: 0.5rem;">{{
                        course.category.name }}</span>
                    <h3 style="margin: 0 0 1rem; font-size: 1.25rem; line-height: 1.4;">{{ course.title }}</h3>
                    <p
                        style="color: var(--text-secondary); font-size: 0.95rem; line-height: 1.6; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; margin-bottom: 1.5rem; flex: 1;">
                        {{ course.description }}</p>
                    <div style="margin-top: auto;">
                        <a href="{{ url_for('admin_bp.course_content', course_id=course.id) }}" class="btn btn-block"
                            style="background: var(--bg-color); border: 1px solid var(--border); color: white; padding: 0.8rem; text-align: center; text-decoration: none; display: block; transition: all 0.2s; font-weight: 500;">
                            Manage Content
                        </a>
                    </div>
                </div>
            </div>
            {% else %}
            <div
                style="grid-column: 1 / -1; text-align: center; padding: 4rem; color: var(--text-secondary); background: rgba(255,255,255,0.02); border-radius: 12px; border: 1px dashed var(--border);">
                <p>No courses created yet.</p>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<!-- Delete Course Modal -->
<div id="deleteCourseModal"
    style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; justify-content: center; align-items: center;">
    <div class="glass-card" style="width: 500px; max-width: 90%; text-align: center; border: 1px solid var(--danger);">
        <h3 style="color: var(--danger); margin-top: 0;">Delete Course</h3>
        <p style="color: var(--text-primary); font-size: 1.1rem; margin-bottom: 0.5rem;">Are you sure you want to delete
            <strong id="delCourseTitle" style="color: white;"></strong>?
        </p>
        <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 2rem;">This action cannot be undone.
            All modules, lessons, assignments, and quizzes will be permanently deleted.</p>

        <form id="deleteCourseForm" method="POST">
            <div
                style="margin-bottom: 2rem; text-align: left; background: rgba(220, 38, 38, 0.05); padding: 1.25rem; border-radius: 8px; border: 1px solid rgba(220, 38, 38, 0.15);">
                <label style="display: flex; gap: 1rem; cursor: pointer; align-items: start; user-select: none;">
                    <div style="position: relative; width: 22px; height: 22px; flex-shrink: 0; margin-top: 2px;">
                        <input type="checkbox" id="confirmDeleteCheck" onchange="toggleDeleteBtn()"
                            style="opacity: 0; position: absolute; width: 100%; height: 100%; cursor: pointer; z-index: 2;">
                        <div class="custom-checkbox"
                            style="width: 100%; height: 100%; border: 2px solid var(--text-secondary); border-radius: 4px; transition: all 0.2s;">
                        </div>
                    </div>
                    <span style="color: var(--text-primary); font-size: 0.95rem; line-height: 1.5; opacity: 0.9;">I
                        confirm that I
                        want to delete this course and understand that all associated data will be lost forever.</span>
                </label>
            </div>

            <div style="display: flex; gap: 1rem;">
                <button type="button" onclick="document.getElementById('deleteCourseModal').style.display='none'"
                    class="btn"
                    style="background: transparent; border: 1px solid var(--border); color: var(--text-secondary);">Cancel</button>
                <button type="submit" id="deleteCourseBtn" class="btn btn-danger"
                    style="flex: 1; opacity: 0.5; cursor: not-allowed;" disabled>Confirm Delete</button>
            </div>
        </form>
    </div>
</div>

<script>
    function openDeleteCourseModal(url, title) {
        document.getElementById('deleteCourseForm').action = url;
        document.getElementById('delCourseTitle').innerText = title;
        document.getElementById('confirmDeleteCheck').checked = false;
        toggleDeleteBtn();
        document.getElementById('deleteCourseModal').style.display = 'flex';
    }

    function toggleDeleteBtn() {
        const btn = document.getElementById('deleteCourseBtn');
        const check = document.getElementById('confirmDeleteCheck');
        if (check.checked) {
            btn.disabled = false;
            btn.style.opacity = '1';
            btn.style.cursor = 'pointer';
        } else {
            btn.disabled = true;
            btn.style.opacity = '0.5';
            btn.style.cursor = 'not-allowed';
        }
    }

    // Close modal on outside click
    window.onclick = function (event) {
        const modal = document.getElementById('deleteCourseModal');
        if (event.target == modal) {
            modal.style.display = 'none';
        }
    }
</script>

{% endblock %}