{% extends "base.html" %}

{% block content %}
<div class="dashboard-container" style="max-width: 1200px;">
    <div class="page-header" style="text-align: center; justify-content: center; margin-bottom: 3rem; display: block;">
        <h1 style="font-size: 2.5rem; font-weight: 800; margin-bottom: 0.5rem;">
            <span class="gradient-text">My Learning</span>
        </h1>
        <p class="text-muted" style="font-size: 1.1rem;">Welcome back, <span class="text-white fw-bold">{{
                current_user.full_name }}</span></p>
    </div>

    <!-- Stats Row -->
    <div class="stats-grid">
        <div class="glass-card stats-card hover-lift">
            <div class="stats-icon-wrapper" style="background: rgba(59, 130, 246, 0.1); color: #60a5fa;">
                <span class="iconify" data-icon="heroicons:book-open"></span>
            </div>
            <div class="stats-info">
                <h3>{{ total_enrolled }}</h3>
                <p>Enrolled Courses</p>
            </div>
        </div>

        <div class="glass-card stats-card hover-lift">
            <div class="stats-icon-wrapper" style="background: rgba(16, 185, 129, 0.1); color: #34d399;">
                <span class="iconify" data-icon="heroicons:chart-bar"></span>
            </div>
            <div class="stats-info">
                <h3>{{ avg_progress }}%</h3>
                <p>Average Progress</p>
            </div>
        </div>

        <div class="glass-card stats-card hover-lift">
            <div class="stats-icon-wrapper" style="background: rgba(245, 158, 11, 0.1); color: #fbbf24;">
                <span class="iconify" data-icon="heroicons:pencil-square"></span>
            </div>
            <div class="stats-info">
                <h3>{{ pending_assignments_count }}</h3>
                <p>Pending Assignments</p>
            </div>
        </div>
    </div>

    <!-- Courses Grid -->
    {% if courses_data %}
    <h3 class="section-title-minimal">Continue Learning</h3>
    <div class="courses-grid-minimal">
        {% for item in courses_data %}
        {% set course = item.course %}
        <div class="minimal-course-card"
            onclick="window.location='{{ url_for('main.course_view', course_id=course.id) }}'">

            <div class="minimal-card-thumb">
                {% if course.thumbnail_url %}
                {% if course.thumbnail_url.startswith('http') %}
                <img src="{{ course.thumbnail_url }}" alt="{{ course.title }}">
                {% else %}
                <img src="{{ url_for('static', filename='uploads/' + course.thumbnail_url) }}" alt="{{ course.title }}">
                {% endif %}
                {% else %}
                <div class="minimal-no-thumb">
                    <span class="iconify" data-icon="heroicons:sparkles"></span>
                </div>
                {% endif %}

                <div class="minimal-category-tag">{{ course.category.name }}</div>
            </div>

            <div class="minimal-card-body">
                <h4 class="minimal-course-title">{{ course.title }}</h4>

                <div class="minimal-progress-wrapper">
                    <div class="minimal-progress-info">
                        <span class="progress-percentage">{{ item.progress }}%</span>
                        <span class="progress-fraction">{{ item.completed }}/{{ item.total_lessons }}</span>
                    </div>
                    <div class="minimal-progress-track">
                        <div class="minimal-progress-fill" style="width: {{ item.progress }}%;"></div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
        <div class="empty-icon">
            <span class="iconify" data-icon="heroicons:folder-open"></span>
        </div>
        <h3>No courses assigned yet</h3>
        <p>It looks like you haven't been enrolled in any courses yet. Please wait
            for an administrator to assign you a course.</p>
    </div>
    {% endif %}
</div>

<!-- Profile Modal (Optimized) -->
<!-- Profile Modal has been moved to base.html -->

<style>
    /* Layout */
    .dashboard-container {
        padding: clamp(1rem, 4vw, 2rem);
        max-width: 1400px;
        margin: 0 auto;
    }

    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2.5rem;
    }

    .gradient-text {
        background: linear-gradient(to right, #60a5fa, #a78bfa);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        font-weight: 800;
        margin-bottom: 0.25rem;
    }

    /* Avatar */
    .avatar-trigger {
        cursor: pointer;
        transition: transform 0.2s;
    }

    .avatar-ring {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        padding: 2px;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
    }

    .avatar-img-main,
    .avatar-placeholder-main {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        object-fit: cover;
        border: 2px solid var(--bg-main);
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--bg-surface);
        color: white;
        font-weight: 700;
    }

    /* Stats Grid */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.5rem;
        margin-bottom: 3rem;
    }

    .stats-card {
        padding: 1.5rem;
        display: flex;
        align-items: center;
        gap: 1.25rem;
        border: 1px solid rgba(255, 255, 255, 0.05);
    }

    .stats-icon-wrapper {
        width: 56px;
        height: 56px;
        border-radius: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.75rem;
    }

    .stats-info h3 {
        font-size: 1.75rem;
        font-weight: 700;
        margin: 0;
        line-height: 1.2;
        color: white;
    }

    .stats-info p {
        margin: 0;
        color: var(--text-muted);
        font-size: 0.9rem;
    }

    /* Courses Grid */
    .section-title {
        font-size: 1.25rem;
        margin-bottom: 1.5rem;
        padding-left: 0.75rem;
        border-left: 4px solid var(--primary);
        color: white !important;
        /* Force visibility */
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .courses-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 2rem;
    }

    .course-card {
        cursor: pointer;
        padding: 0;
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.05);
        display: flex;
        flex-direction: column;
        height: 100%;
    }

    .course-thumb {
        height: 180px;
        position: relative;
        background: var(--bg-surface);
    }

    .course-thumb img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.5s;
    }

    .course-card:hover .course-thumb img {
        transform: scale(1.05);
    }

    .no-thumb {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 3rem;
        color: rgba(255, 255, 255, 0.1);
        background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
    }

    .category-badge {
        position: absolute;
        top: 1rem;
        right: 1rem;
        background: rgba(15, 23, 42, 0.8);
        backdrop-filter: blur(4px);
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.75rem;
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: white;
    }

    .course-body {
        padding: 1.5rem;
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    .course-title {
        font-size: 1.15rem;
        margin: 0 0 1.5rem 0;
        line-height: 1.4;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .progress-container {
        margin-top: auto;
    }

    .progress-track {
        height: 6px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        overflow: hidden;
        margin-bottom: 0.5rem;
    }

    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--primary), #60a5fa);
        border-radius: 10px;
    }

    .progress-meta {
        display: flex;
        justify-content: space-between;
        font-size: 0.85rem;
    }

    .progress-text {
        color: var(--primary);
        font-weight: 500;
    }

    .lesson-count {
        color: var(--text-secondary);
    }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 4rem 1rem;
        background: rgba(255, 255, 255, 0.02);
        border-radius: var(--radius-md);
        border: 1px dashed rgba(255, 255, 255, 0.1);
    }

    .empty-state h3 {
        margin: 1rem 0 0.5rem;
        color: white;
    }

    .empty-state p {
        color: var(--text-muted);
        max-width: 400px;
        margin: 0 auto;
    }

    @media (max-width: 768px) {
        .header-actions {
            display: none !important;
        }
    }
</style>

{% endblock %}